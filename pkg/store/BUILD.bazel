load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")

go_library(
    name = "store",
    srcs = [
        "bucket.go",
        "flushable.go",
        "io.go",
        "lazy_postings.go",
        "limiter.go",
        "local.go",
        "postings.go",
        "postings_codec.go",
        "prometheus.go",
        "proxy.go",
        "proxy_merge.go",
        "recover.go",
        "telemetry.go",
        "tsdb.go",
        "tsdb_selector.go",
    ],
    importpath = "github.com/thanos-io/thanos/pkg/store",
    visibility = ["//visibility:public"],
    deps = [
        "//pkg/block",
        "//pkg/block/indexheader",
        "//pkg/block/metadata",
        "//pkg/clientconfig",
        "//pkg/compact/downsample",
        "//pkg/component",
        "//pkg/extgrpc/snappy",
        "//pkg/extkingpin",
        "//pkg/extprom",
        "//pkg/filter",
        "//pkg/gate",
        "//pkg/info/infopb",
        "//pkg/losertree",
        "//pkg/model",
        "//pkg/pool",
        "//pkg/promclient",
        "//pkg/runutil",
        "//pkg/store/cache",
        "//pkg/store/hintspb",
        "//pkg/store/labelpb",
        "//pkg/store/storepb",
        "//pkg/store/storepb/prompb",
        "//pkg/strutil",
        "//pkg/tenancy",
        "//pkg/tracing",
        "//pkg/tracing/tracing_middleware",
        "@com_github_alecthomas_units//:units",
        "@com_github_blang_semver_v4//:semver",
        "@com_github_cespare_xxhash//:xxhash",
        "@com_github_cespare_xxhash_v2//:xxhash",
        "@com_github_go_kit_log//:log",
        "@com_github_go_kit_log//level",
        "@com_github_gogo_protobuf//jsonpb",
        "@com_github_gogo_protobuf//proto",
        "@com_github_gogo_protobuf//types",
        "@com_github_golang_snappy//:snappy",
        "@com_github_klauspost_compress//s2",
        "@com_github_oklog_ulid//:ulid",
        "@com_github_opentracing_opentracing_go//:opentracing-go",
        "@com_github_pkg_errors//:errors",
        "@com_github_prometheus_client_golang//prometheus",
        "@com_github_prometheus_client_golang//prometheus/promauto",
        "@com_github_prometheus_common//model",
        "@com_github_prometheus_prometheus//config",
        "@com_github_prometheus_prometheus//model/labels",
        "@com_github_prometheus_prometheus//model/relabel",
        "@com_github_prometheus_prometheus//storage",
        "@com_github_prometheus_prometheus//storage/remote",
        "@com_github_prometheus_prometheus//tsdb/chunkenc",
        "@com_github_prometheus_prometheus//tsdb/chunks",
        "@com_github_prometheus_prometheus//tsdb/encoding",
        "@com_github_prometheus_prometheus//tsdb/fileutil",
        "@com_github_prometheus_prometheus//tsdb/index",
        "@com_github_thanos_io_objstore//:objstore",
        "@com_github_weaveworks_common//httpgrpc",
        "@org_golang_google_grpc//:grpc",
        "@org_golang_google_grpc//codes",
        "@org_golang_google_grpc//metadata",
        "@org_golang_google_grpc//status",
        "@org_golang_x_exp//maps",
        "@org_golang_x_exp//slices",
        "@org_golang_x_sync//errgroup",
        "@org_uber_go_atomic//:atomic",
    ],
)

alias(
    name = "go_default_library",
    actual = ":store",
    visibility = ["//visibility:public"],
)

go_test(
    name = "store_test",
    srcs = [
        "acceptance_test.go",
        "bucket_e2e_test.go",
        "bucket_test.go",
        "io_test.go",
        "lazy_postings_test.go",
        "limiter_test.go",
        "postings_codec_test.go",
        "prometheus_test.go",
        "proxy_merge_test.go",
        "proxy_test.go",
        "recover_test.go",
        "tsdb_selector_test.go",
        "tsdb_test.go",
    ],
    embed = [":store"],
    deps = [
        "//pkg/block",
        "//pkg/block/indexheader",
        "//pkg/block/metadata",
        "//pkg/compact",
        "//pkg/compact/downsample",
        "//pkg/component",
        "//pkg/errors",
        "//pkg/gate",
        "//pkg/info/infopb",
        "//pkg/model",
        "//pkg/pool",
        "//pkg/promclient",
        "//pkg/store/cache",
        "//pkg/store/hintspb",
        "//pkg/store/labelpb",
        "//pkg/store/storepb",
        "//pkg/store/storepb/prompb",
        "//pkg/store/storepb/testutil",
        "//pkg/tenancy",
        "//pkg/testutil/custom",
        "//pkg/testutil/e2eutil",
        "@com_github_alecthomas_units//:units",
        "@com_github_cespare_xxhash//:xxhash",
        "@com_github_cespare_xxhash_v2//:xxhash",
        "@com_github_efficientgo_core//testutil",
        "@com_github_go_kit_log//:log",
        "@com_github_gogo_protobuf//proto",
        "@com_github_gogo_protobuf//types",
        "@com_github_gogo_status//:status",
        "@com_github_klauspost_compress//s2",
        "@com_github_leanovate_gopter//:gopter",
        "@com_github_leanovate_gopter//gen",
        "@com_github_leanovate_gopter//prop",
        "@com_github_oklog_ulid//:ulid",
        "@com_github_pkg_errors//:errors",
        "@com_github_prometheus_client_golang//prometheus",
        "@com_github_prometheus_client_golang//prometheus/promauto",
        "@com_github_prometheus_client_golang//prometheus/testutil",
        "@com_github_prometheus_client_model//go",
        "@com_github_prometheus_common//model",
        "@com_github_prometheus_prometheus//model/labels",
        "@com_github_prometheus_prometheus//model/relabel",
        "@com_github_prometheus_prometheus//model/timestamp",
        "@com_github_prometheus_prometheus//storage",
        "@com_github_prometheus_prometheus//tsdb",
        "@com_github_prometheus_prometheus//tsdb/chunkenc",
        "@com_github_prometheus_prometheus//tsdb/encoding",
        "@com_github_prometheus_prometheus//tsdb/index",
        "@com_github_thanos_io_objstore//:objstore",
        "@com_github_thanos_io_objstore//objtesting",
        "@com_github_thanos_io_objstore//providers/filesystem",
        "@org_golang_google_grpc//:grpc",
        "@org_golang_google_grpc//codes",
        "@org_golang_x_exp//slices",
        "@org_uber_go_atomic//:atomic",
    ],
)
